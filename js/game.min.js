function gameLoop(){isPaused?requestAnimationFrame(gameLoop):(requestAnimationFrame(gameLoop),++config.step<config.stepMax||(config.step=0,ctx.clearRect(0,0,canvas.width,canvas.height),drawFood(),drawSnake(),ctx.strokeStyle="#fff",ctx.lineWidth=5,ctx.strokeRect(0,0,canvas.width,canvas.height),drawBomb()))}function score(){scoreCount++,bestScore(),scoreCount<=6?config.stepMax=15:scoreCount>6&&scoreCount<=12?config.stepMax=10:scoreCount>12&&scoreCount<=18?config.stepMax=7:scoreCount>18&&(config.stepMax=4),drawScore()}function drawScore(){scoreBlock.innerHTML=scoreCount}function bestScore(){localStorage.getItem("best score")||localStorage.setItem("best score",0),scoreCount>localStorage.getItem("best score")&&localStorage.setItem("best score",scoreCount),bestScoreBlock.innerHTML=localStorage.getItem("best score")}function checkBorder(){snake.x<0?(audioPlay("dead"),restart()):snake.x>=canvas.width&&(audioPlay("dead"),restart()),snake.y<0?(audioPlay("dead"),restart()):snake.y>=canvas.height&&(audioPlay("dead"),restart())}function restart(){config.stepMax=15,scoreCount=0,drawScore(),snake.x=config.sizeCell,snake.y=config.sizeCell,snake.body=[],snake.maxBodySize=1,snake.dirX=0,snake.dirY=0,dir="",prevSkinColor=0,skinColor=0,snakeStyles(snake,0),randomPosFoodAndBomb()}function drawSnake(){snake.x+=snake.dirX,snake.y+=snake.dirY,checkBorder(),snake.body.unshift({x:snake.x,y:snake.y}),snake.body.length>snake.maxBodySize&&snake.body.pop(),snake.body.forEach((e,n)=>{if(snakeStyles(e,n),e.x==food.x&&e.y==food.y&&(audioPlay("eat"),score(),randomPosFoodAndBomb(),snake.maxBodySize++),e.x===bomb.x&&e.y===bomb.y)if(skinColor=0,prevSkinColor=0,scoreCount>=2){audioPlay("hit"),scoreCount=Math.ceil(scoreCount/2),snake.maxBodySize=scoreCount+1;for(let e=0;e<snake.maxBodySize;e++)snake.body.pop();drawScore(),bomb.x=-config.sizeCell,bomb.y=-config.sizeCell}else audioPlay("dead"),restart();for(let o=n+1;o<snake.body.length;o++)e.x===snake.body[o].x&&e.y===snake.body[o].y&&(audioPlay("dead"),restart())})}function snakeStyles(e,n){0===n?ctx.drawImage(snakeImages[prevSkinColor],e.x,e.y,config.sizeCell,config.sizeCell):(ctx.fillStyle=skinColors[prevSkinColor],ctx.strokeStyle="#071510",ctx.lineWidth=1,ctx.fillRect(e.x,e.y,config.sizeCell,config.sizeCell),ctx.strokeRect(e.x,e.y,config.sizeCell-1,config.sizeCell-1))}function turnUp(){"down"!=dir&&(audioPlay("turn"),dir="up",snake.dirY=-config.sizeCell,snake.dirX=0)}function turnLeft(){"right"!=dir&&(audioPlay("turn"),dir="left",snake.dirX=-config.sizeCell,snake.dirY=0)}function turnDown(){"up"!=dir&&(audioPlay("turn"),dir="down",snake.dirY=config.sizeCell,snake.dirX=0)}function turnRight(){"left"!=dir&&(audioPlay("turn"),dir="right",snake.dirX=config.sizeCell,snake.dirY=0)}function togglePause(){isPaused=!isPaused,document.getElementById("pause-effect").classList.toggle("hidden")}function randomInt(e,n){return Math.floor(Math.random()*(n-e)+e)}function randomImg(){prevSkinColor=skinColor;let e=randomInt(0,images.length);skinColor=e+1;let n=images[e];return img.src=n,img}function drawFood(){ctx.drawImage(img,food.x,food.y,config.sizeFood,config.sizeFood)}function drawBomb(){ctx.drawImage(bombImg,bomb.x,bomb.y,config.sizeFood,config.sizeFood)}function randomPosFoodAndBomb(){for(;;){randomImg(),food.x=randomInt(0,canvas.width/config.sizeCell)*config.sizeCell,food.y=randomInt(0,canvas.height/config.sizeCell)*config.sizeCell;let e=randomInt(1,4);if(2===e?(bomb.x=randomInt(0,canvas.width/config.sizeCell)*config.sizeCell,bomb.y=randomInt(0,canvas.height/config.sizeCell)*config.sizeCell):(bomb.x=-config.sizeCell,bomb.y=-config.sizeCell),food.x!==bomb.x||food.y!==bomb.y)break}drawFood(),drawBomb()}function audioPlay(e){"eat"===e&&audioNames[0].play(),"turn"===e&&audioNames[1].play(),"dead"===e&&audioNames[2].play(),"hit"===e&&audioNames[3].play()}let canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),scoreBlock=document.getElementById("score"),scoreCount=0,bestScoreBlock=document.getElementById("best-score"),dir="",skinColor=0,prevSkinColor=0,isPaused=!1,helpToggledPause=!1,instructionToggledPause=!1;const config={sizeCell:24,sizeFood:24,step:0,stepMax:15},snake={x:config.sizeCell,y:config.sizeCell,dirX:0,dirY:0,body:[],maxBodySize:1},snakeSkins=["./img/snake/headGreen.svg","./img/snake/headRed.svg","./img/snake/headOrange.svg","./img/snake/headPurple.svg","./img/snake/headYellow.svg"],skinColors=["#07691D","#8B0000","#BF6900","#301934","#8B8000"],snakeImages=[imgHeadGreen=new Image,imgHeadRed=new Image,imgHeadOrange=new Image,imgHeadPurple=new Image,imgHeadYellow=new Image];for(let e=0;e<snakeImages.length;e++)snakeImages[e].src=snakeSkins[e];const food={x:randomInt(0,canvas.width/config.sizeCell)*config.sizeCell,y:randomInt(0,canvas.height/config.sizeCell)*config.sizeCell},images=["./img/food/apple.svg","./img/food/carrot.svg","./img/food/eggplant.svg","./img/food/banana.svg"];let img=new Image;img.src=images[0];const bomb={x:-config.sizeCell,y:-config.sizeCell},bombImg=new Image;bombImg.src="./img/food/bomb.svg";const audio=["./audio/eat.mp3","./audio/turn.mp3","./audio/dead.mp3","./audio/hit.mp3"],audioNames=[audioEat=new Audio,audioTurn=new Audio,audioDead=new Audio,audioHit=new Audio];for(let e=0;e<audio.length;e++)audioNames[e].src=audio[e];window.addEventListener("load",e=>{window.innerWidth<=650?(canvas.width=300,canvas.height=300,ctx.fillStyle="#000000",ctx.fillRect(0,0,canvas.width,canvas.height),config.sizeCell=15,config.sizeFood=15,canvas.style='background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUiIGhlaWdodD0iMTUiIHZpZXdCb3g9IjAgMCAxNSAxNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjE1IiBoZWlnaHQ9IjE1IiBmaWxsPSJibGFjayIvPgo8Y2lyY2xlIGN4PSI3LjUiIGN5PSI3LjUiIHI9IjIuNSIgZmlsbD0iIzUxNDk0OSIvPgo8L3N2Zz4K");',restart()):window.innerWidth>650&&(canvas.width=600,canvas.height=480,ctx.fillStyle="#000000",ctx.fillRect(0,0,canvas.width,canvas.height),config.sizeCell=24,config.sizeFood=24,canvas.style='background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBmaWxsPSJibGFjayIvPgo8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI0IiBmaWxsPSIjNTE0OTQ5Ii8+Cjwvc3ZnPgo=");',restart())}),window.addEventListener("resize",e=>{window.innerWidth<=650?(canvas.width=300,canvas.height=300,ctx.fillStyle="#000000",ctx.fillRect(0,0,canvas.width,canvas.height),config.sizeCell=15,config.sizeFood=15,canvas.style='background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUiIGhlaWdodD0iMTUiIHZpZXdCb3g9IjAgMCAxNSAxNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjE1IiBoZWlnaHQ9IjE1IiBmaWxsPSJibGFjayIvPgo8Y2lyY2xlIGN4PSI3LjUiIGN5PSI3LjUiIHI9IjIuNSIgZmlsbD0iIzUxNDk0OSIvPgo8L3N2Zz4K");'):window.innerWidth>650&&(canvas.width=600,canvas.height=480,ctx.fillStyle="#000000",ctx.fillRect(0,0,canvas.width,canvas.height),config.sizeCell=24,config.sizeFood=24,canvas.style='background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBmaWxsPSJibGFjayIvPgo8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI0IiBmaWxsPSIjNTE0OTQ5Ii8+Cjwvc3ZnPgo=");')}),gameLoop(),document.addEventListener("load",bestScore()),document.addEventListener("keydown",e=>{"w"===e.key||"ArrowUp"===e.key?turnUp():"a"===e.key||"ArrowLeft"===e.key?turnLeft():"s"===e.key||"ArrowDown"===e.key?turnDown():"d"===e.key||"ArrowRight"===e.key?turnRight():"p"===e.key&&document.getElementById("help-window").classList.contains("hidden")&&document.getElementById("instruction-window").classList.contains("hidden")&&togglePause()}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("help-link"),n=document.getElementById("help-window"),o=document.getElementById("help-close-btn");e.addEventListener("click",function(e){e.preventDefault(),n.classList.remove("hidden"),document.getElementById("pause-effect").classList.contains("hidden")&&(togglePause(),helpToggledPause=!0)}),o.addEventListener("click",function(){n.classList.add("hidden"),!document.getElementById("pause-effect").classList.contains("hidden")&&helpToggledPause&&(togglePause(),helpToggledPause=!1)}),n.addEventListener("click",function(e){e.target===n&&(n.classList.add("hidden"),!document.getElementById("pause-effect").classList.contains("hidden")&&helpToggledPause&&(togglePause(),helpToggledPause=!1))})}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("instruction-link"),n=document.getElementById("instruction-window"),o=document.getElementById("instruction-close-btn");e.addEventListener("click",function(e){e.preventDefault(),n.classList.remove("hidden"),document.getElementById("pause-effect").classList.contains("hidden")&&(togglePause(),instructionToggledPause=!0)}),o.addEventListener("click",function(){n.classList.add("hidden"),!document.getElementById("pause-effect").classList.contains("hidden")&&instructionToggledPause&&(togglePause(),instructionToggledPause=!1)}),n.addEventListener("click",function(e){e.target===n&&(n.classList.add("hidden"),!document.getElementById("pause-effect").classList.contains("hidden")&&instructionToggledPause&&(togglePause(),instructionToggledPause=!1))})});const isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};if(isMobile.any()){alert("Please click any where for play game sounds"),document.addEventListener("touchstart",handleTouchStart),document.addEventListener("touchmove",handleTouchMove);let e=null,n=null;function handleTouchStart(o){const i=o.touches[0];e=i.clientX,n=i.clientY}function handleTouchMove(o){if(!e||!n)return!1;let i=o.touches[0].clientX,t=o.touches[0].clientY,a=i-e,s=t-n;Math.abs(a)>Math.abs(s)?a>0?turnRight():turnLeft():s<0?turnUp():turnDown(),e=null,n=null}}"getBattery"in navigator?navigator.getBattery().then(function(e){function n(){!e.charging&&e.level<.2?document.getElementById("battery-indicator").classList.remove("hidden"):document.getElementById("battery-indicator").classList.add("hidden")}n(),e.addEventListener("levelchange",n),e.addEventListener("chargingchange",n)}):console.log("Battery Status API is not supported on this browser.");